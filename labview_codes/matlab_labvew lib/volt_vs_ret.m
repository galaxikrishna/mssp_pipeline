function [ret,volt]=volt_vs_ret(arr,v)%arr is 2D array of size 3 x n. 1st row is volt
%2nd and 3rd row are intensity of the 2 beams. v is the voltage at which
%lcvr is at halfwave
pnt=find(arr(1,:)==v);%to find intensity at 180deg retardance
if arr(2,pnt) >= arr(3,pnt)%to segregate rising and falling beams
    I1=arr(2,:);%I1 takes the rising beam 
    I2=arr(3,:);%I2 takes the falling beam
else
    I1=arr(3,:);
    I2=arr(2,:);
end
I1=I1/max(I1);%i normalized the intensity coz lcvr is at 45deg w.r.t polariser
I2=I2/max(I2);

%now we interpolate to get actual volt vs ret
r1=180:-1:1;
r2=360:-1:181;
xx=find(I1==max(I1));
%theoritical intensities It1 and It2 for 1:180 and 181:360 deg retardance
%falling beam
It1=[1,0.999923847578196,0.999695413509548,0.999314767377287,0.998782025129912,0.998097349045873,0.997260947684137,0.996273075820661,0.995134034370785,0.993844170297569,0.992403876506104,0.990813591723832,0.989073800366903,0.987185032392618,0.985147863137998,0.982962913144534,0.980630847969159,0.978152377981518,0.975528258147577,0.972759287799659,0.969846310392954,0.966790213248601,0.963591927283394,0.960252426726220,0.956772728821300,0.953153893518325,0.949397023149584,0.945503262094184,0.941473796429464,0.937309853569698,0.933012701892219,0.928583650351056,0.924024048078213,0.919335283972712,0.914518786277521,0.909576022144496,0.904508497187474,0.899317755023646,0.894005376803361,0.888572980728486,0.883022221559489,0.877354790111386,0.871572412738697,0.865676850809585,0.859669900169326,0.853553390593274,0.847329185229499,0.840999180031249,0.834565303179429,0.828029514495254,0.821393804843270,0.814660195524919,0.807830737662829,0.800907511576024,0.793892626146237,0.786788218175523,0.779596451735374,0.772319517507514,0.764959632116603,0.757519037455027,0.750000000000000,0.742404810123169,0.734735781392945,0.726995249869773,0.719185573394539,0.711309130870350,0.703368321537900,0.695365564244637,0.687303296707956,0.679183974772650,0.671010071662834,0.662784077228578,0.654508497187474,0.646185852361368,0.637818677908500,0.629409522551260,0.620960947799834,0.612475527171933,0.603955845408880,0.595404497688272,0.586824088833465,0.578217232520116,0.569586550480033,0.560934671702574,0.552264231633827,0.543577871373829,0.534878236872063,0.526167978121472,0.517449748351251,0.508726203218642,0.500000000000000,0.491273796781358,0.482550251648750,0.473832021878528,0.465121763127937,0.456422128626171,0.447735768366173,0.439065328297426,0.430413449519967,0.421782767479885,0.413175911166535,0.404595502311728,0.396044154591120,0.387524472828067,0.379039052200166,0.370590477448740,0.362181322091500,0.353814147638632,0.345491502812526,0.337215922771422,0.328989928337166,0.320816025227350,0.312696703292044,0.304634435755363,0.296631678462100,0.288690869129650,0.280814426605461,0.273004750130227,0.265264218607055,0.257595189876832,0.250000000000000,0.242480962544973,0.235040367883398,0.227680482492487,0.220403548264627,0.213211781824477,0.206107373853763,0.199092488423976,0.192169262337171,0.185339804475081,0.178606195156730,0.171970485504746,0.165434696820571,0.159000819968751,0.152670814770501,0.146446609406726,0.140330099830674,0.134323149190415,0.128427587261303,0.122645209888614,0.116977778440511,0.111427019271515,0.105994623196639,0.100682244976354,0.0954915028125263,0.0904239778555041,0.0854812137224792,0.0806647160272880,0.0759759519217871,0.0714163496489438,0.0669872981077806,0.0626901464303021,0.0585262035705365,0.0544967379058161,0.0506029768504165,0.0468461064816750,0.0432272711786996,0.0397475732737798,0.0364080727166063,0.0332097867513992,0.0301536896070458,0.0272407122003415,0.0244717418524232,0.0218476220184822,0.0193691520308406,0.0170370868554659,0.0148521368620018,0.0128149676073823,0.0109261996330972,0.00918640827616801,0.00759612349389593,0.00615582970243112,0.00486596562921482,0.00372692417933895,0.00273905231586336,0.00190265095412723,0.00121797487008790,0.000685232622713139,0.000304586490452063,7.61524218043652e-05];
It2=[0,7.61524218043652e-05,0.000304586490452063,0.000685232622713139,0.00121797487008790,0.00190265095412723,0.00273905231586336,0.00372692417933895,0.00486596562921482,0.00615582970243112,0.00759612349389593,0.00918640827616801,0.0109261996330972,0.0128149676073823,0.0148521368620018,0.0170370868554659,0.0193691520308406,0.0218476220184822,0.0244717418524232,0.0272407122003415,0.0301536896070458,0.0332097867513992,0.0364080727166063,0.0397475732737798,0.0432272711786996,0.0468461064816750,0.0506029768504165,0.0544967379058161,0.0585262035705365,0.0626901464303021,0.0669872981077806,0.0714163496489438,0.0759759519217871,0.0806647160272880,0.0854812137224792,0.0904239778555041,0.0954915028125263,0.100682244976354,0.105994623196639,0.111427019271515,0.116977778440511,0.122645209888614,0.128427587261303,0.134323149190415,0.140330099830674,0.146446609406726,0.152670814770501,0.159000819968751,0.165434696820571,0.171970485504746,0.178606195156730,0.185339804475081,0.192169262337171,0.199092488423976,0.206107373853763,0.213211781824477,0.220403548264627,0.227680482492487,0.235040367883398,0.242480962544973,0.250000000000000,0.257595189876832,0.265264218607055,0.273004750130227,0.280814426605461,0.288690869129650,0.296631678462100,0.304634435755363,0.312696703292044,0.320816025227350,0.328989928337166,0.337215922771422,0.345491502812526,0.353814147638632,0.362181322091500,0.370590477448740,0.379039052200166,0.387524472828067,0.396044154591120,0.404595502311728,0.413175911166535,0.421782767479885,0.430413449519967,0.439065328297426,0.447735768366173,0.456422128626171,0.465121763127937,0.473832021878528,0.482550251648750,0.491273796781358,0.500000000000000,0.508726203218642,0.517449748351251,0.526167978121472,0.534878236872063,0.543577871373829,0.552264231633827,0.560934671702574,0.569586550480033,0.578217232520116,0.586824088833465,0.595404497688272,0.603955845408880,0.612475527171933,0.620960947799834,0.629409522551260,0.637818677908500,0.646185852361368,0.654508497187474,0.662784077228578,0.671010071662834,0.679183974772650,0.687303296707956,0.695365564244637,0.703368321537900,0.711309130870350,0.719185573394539,0.726995249869773,0.734735781392945,0.742404810123169,0.750000000000000,0.757519037455027,0.764959632116603,0.772319517507514,0.779596451735374,0.786788218175523,0.793892626146237,0.800907511576024,0.807830737662829,0.814660195524919,0.821393804843270,0.828029514495254,0.834565303179429,0.840999180031249,0.847329185229499,0.853553390593274,0.859669900169326,0.865676850809585,0.871572412738697,0.877354790111386,0.883022221559489,0.888572980728486,0.894005376803361,0.899317755023646,0.904508497187474,0.909576022144496,0.914518786277521,0.919335283972712,0.924024048078213,0.928583650351056,0.933012701892219,0.937309853569698,0.941473796429464,0.945503262094184,0.949397023149584,0.953153893518325,0.956772728821300,0.960252426726220,0.963591927283394,0.966790213248601,0.969846310392954,0.972759287799659,0.975528258147577,0.978152377981518,0.980630847969159,0.982962913144534,0.985147863137998,0.987185032392618,0.989073800366903,0.990813591723832,0.992403876506104,0.993844170297569,0.995134034370785,0.996273075820661,0.997260947684137,0.998097349045873,0.998782025129912,0.999314767377287,0.999695413509548,0.999923847578196];
ret1=interp1(It1,r2,I2(1:xx-1));%1st part of the ret vs volt curve(360:181)
ret2=interp1(It2,r1,I2(xx:end));%2nd part of ret vs volt curve(180:1)
reta=smooth([ret1,ret2],20);
%rising beam
It1=[0,7.61524218043652e-05,0.000304586490452063,0.000685232622713139,0.00121797487008790,0.00190265095412723,0.00273905231586336,0.00372692417933895,0.00486596562921482,0.00615582970243112,0.00759612349389593,0.00918640827616801,0.0109261996330972,0.0128149676073823,0.0148521368620018,0.0170370868554659,0.0193691520308406,0.0218476220184822,0.0244717418524232,0.0272407122003415,0.0301536896070458,0.0332097867513992,0.0364080727166063,0.0397475732737798,0.0432272711786996,0.0468461064816750,0.0506029768504165,0.0544967379058161,0.0585262035705365,0.0626901464303021,0.0669872981077806,0.0714163496489438,0.0759759519217871,0.0806647160272880,0.0854812137224792,0.0904239778555041,0.0954915028125263,0.100682244976354,0.105994623196639,0.111427019271515,0.116977778440511,0.122645209888614,0.128427587261303,0.134323149190415,0.140330099830674,0.146446609406726,0.152670814770501,0.159000819968751,0.165434696820571,0.171970485504746,0.178606195156730,0.185339804475081,0.192169262337171,0.199092488423976,0.206107373853763,0.213211781824477,0.220403548264627,0.227680482492487,0.235040367883398,0.242480962544973,0.250000000000000,0.257595189876832,0.265264218607055,0.273004750130227,0.280814426605461,0.288690869129650,0.296631678462100,0.304634435755363,0.312696703292044,0.320816025227350,0.328989928337166,0.337215922771422,0.345491502812526,0.353814147638632,0.362181322091500,0.370590477448740,0.379039052200166,0.387524472828067,0.396044154591120,0.404595502311728,0.413175911166535,0.421782767479885,0.430413449519967,0.439065328297426,0.447735768366173,0.456422128626171,0.465121763127937,0.473832021878528,0.482550251648750,0.491273796781358,0.500000000000000,0.508726203218642,0.517449748351251,0.526167978121472,0.534878236872063,0.543577871373829,0.552264231633827,0.560934671702574,0.569586550480033,0.578217232520116,0.586824088833465,0.595404497688272,0.603955845408880,0.612475527171933,0.620960947799834,0.629409522551260,0.637818677908500,0.646185852361368,0.654508497187474,0.662784077228578,0.671010071662834,0.679183974772650,0.687303296707956,0.695365564244637,0.703368321537900,0.711309130870350,0.719185573394539,0.726995249869773,0.734735781392945,0.742404810123169,0.750000000000000,0.757519037455027,0.764959632116603,0.772319517507514,0.779596451735374,0.786788218175523,0.793892626146237,0.800907511576024,0.807830737662829,0.814660195524919,0.821393804843270,0.828029514495254,0.834565303179429,0.840999180031249,0.847329185229499,0.853553390593274,0.859669900169326,0.865676850809585,0.871572412738697,0.877354790111386,0.883022221559489,0.888572980728486,0.894005376803361,0.899317755023646,0.904508497187474,0.909576022144496,0.914518786277521,0.919335283972712,0.924024048078213,0.928583650351056,0.933012701892219,0.937309853569698,0.941473796429464,0.945503262094184,0.949397023149584,0.953153893518325,0.956772728821300,0.960252426726220,0.963591927283394,0.966790213248601,0.969846310392954,0.972759287799659,0.975528258147577,0.978152377981518,0.980630847969159,0.982962913144534,0.985147863137998,0.987185032392618,0.989073800366903,0.990813591723832,0.992403876506104,0.993844170297569,0.995134034370785,0.996273075820661,0.997260947684137,0.998097349045873,0.998782025129912,0.999314767377287,0.999695413509548,0.999923847578196];
It2=[1,0.999923847578196,0.999695413509548,0.999314767377287,0.998782025129912,0.998097349045873,0.997260947684137,0.996273075820661,0.995134034370785,0.993844170297569,0.992403876506104,0.990813591723832,0.989073800366903,0.987185032392618,0.985147863137998,0.982962913144534,0.980630847969159,0.978152377981518,0.975528258147577,0.972759287799659,0.969846310392954,0.966790213248601,0.963591927283394,0.960252426726220,0.956772728821300,0.953153893518325,0.949397023149584,0.945503262094184,0.941473796429464,0.937309853569698,0.933012701892219,0.928583650351056,0.924024048078213,0.919335283972712,0.914518786277521,0.909576022144496,0.904508497187474,0.899317755023646,0.894005376803361,0.888572980728486,0.883022221559489,0.877354790111386,0.871572412738697,0.865676850809585,0.859669900169326,0.853553390593274,0.847329185229499,0.840999180031249,0.834565303179429,0.828029514495254,0.821393804843270,0.814660195524919,0.807830737662829,0.800907511576024,0.793892626146237,0.786788218175523,0.779596451735374,0.772319517507514,0.764959632116603,0.757519037455027,0.750000000000000,0.742404810123169,0.734735781392945,0.726995249869773,0.719185573394539,0.711309130870350,0.703368321537900,0.695365564244637,0.687303296707956,0.679183974772650,0.671010071662834,0.662784077228578,0.654508497187474,0.646185852361368,0.637818677908500,0.629409522551260,0.620960947799834,0.612475527171933,0.603955845408880,0.595404497688272,0.586824088833465,0.578217232520116,0.569586550480033,0.560934671702574,0.552264231633827,0.543577871373829,0.534878236872063,0.526167978121472,0.517449748351251,0.508726203218642,0.500000000000000,0.491273796781358,0.482550251648750,0.473832021878528,0.465121763127937,0.456422128626171,0.447735768366173,0.439065328297426,0.430413449519967,0.421782767479885,0.413175911166535,0.404595502311728,0.396044154591120,0.387524472828067,0.379039052200166,0.370590477448740,0.362181322091500,0.353814147638632,0.345491502812526,0.337215922771422,0.328989928337166,0.320816025227350,0.312696703292044,0.304634435755363,0.296631678462100,0.288690869129650,0.280814426605461,0.273004750130227,0.265264218607055,0.257595189876832,0.250000000000000,0.242480962544973,0.235040367883398,0.227680482492487,0.220403548264627,0.213211781824477,0.206107373853763,0.199092488423976,0.192169262337171,0.185339804475081,0.178606195156730,0.171970485504746,0.165434696820571,0.159000819968751,0.152670814770501,0.146446609406726,0.140330099830674,0.134323149190415,0.128427587261303,0.122645209888614,0.116977778440511,0.111427019271515,0.105994623196639,0.100682244976354,0.0954915028125263,0.0904239778555041,0.0854812137224792,0.0806647160272880,0.0759759519217871,0.0714163496489438,0.0669872981077806,0.0626901464303021,0.0585262035705365,0.0544967379058161,0.0506029768504165,0.0468461064816750,0.0432272711786996,0.0397475732737798,0.0364080727166063,0.0332097867513992,0.0301536896070458,0.0272407122003415,0.0244717418524232,0.0218476220184822,0.0193691520308406,0.0170370868554659,0.0148521368620018,0.0128149676073823,0.0109261996330972,0.00918640827616801,0.00759612349389593,0.00615582970243112,0.00486596562921482,0.00372692417933895,0.00273905231586336,0.00190265095412723,0.00121797487008790,0.000685232622713139,0.000304586490452063,7.61524218043652e-05];
ret1=interp1(It1,r2,I1(1:xx-1));
ret2=interp1(It2,r1,I1(xx:end));
retb=smooth([ret1,ret2],20);
% for i=1:length(retb)
%     if issorted(retb(i:end))
%         break
%     end
% end
ret=(retb);%a+retb)/2; %I removed falling curve coz its results are not accurate 
volt=arr(1,1:end)';
%fan=[volt,ret];